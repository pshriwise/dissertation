\section{Signed Distance Field Utilization}\label{section:preconditioner_utilization}

In effect, the preconditioner is attempting to check whether or not the particle
will actually cross a surface before explicitly searching for the particle's
intersection with a surface along its current trajectory. If the result of this
preconditioning check is always false and a ray is always fired, then these
checks are only adding to the computational cost of the problem. This will
always occur in volumes filled with void, for example, as particles immediately
travel from one surface to another. As a result, the signed distance field
should be applied selectively depending on each volume's geometric and material
properties for optimal performance and high utilization of the preconditioning
methods. Ideally, this method will only be applied to volumes in which the data
structure is able to precondition ray fire calls often or with high utilization
of the data structure. The signed distance field is expected to have the biggest
impact in performance when preconditioning next surface intersection queries, as
they are most frequently called in Monte Carlo codes when tracking particles
through the geometry. As such, this type of query is the focus of utilization
measurement for the remainder of this section.

\begin{equation}
  U = \frac{ \small \text{Rays Avoided w/ SDF} }{ \small \text{Number of Geometry Queries} } 
   \label{eq:preconditioner_utilization}
%  \caption{Definition of signed distance field utilization as a ray fire preconditioner in DAGMC.}
\end{equation}

The utilization, $U$, of the signed distance field as a ray fire preconditioner can be
described as the number of rays fire calls related to the next surface
intersection queries that are avoided divided by the total number of next surface
intersection queries made by the Monte Carlo code. This value is described
in Eq. \ref{eq:preconditioner_utilization} and can be quantified using this
definition using debugging tools, such as Valgrind, during DAGMC simulations.
It is expected that in the majority of cases, as the utilization of preconditioning
methods goes up, the performance of the simulation will also improve.

\begin{figure}[ht]
  \centering
  \includesvg{../images/sdf_hydrogen_density_study_perf}{0.5\textwidth}
  \caption{Performance results for a 5 MeV neutron source at the origin of a 10
    cm radius sphere. Hydrogen density was varied from 0 to 1
    $\frac{g}{cm^3}$. Simulations of 100M histories at each density were
    performed using native MCNP5, DAG-MCNP5 without the signed distance field,
    and DAG-MCNP5 with the signed distance field.}
  \label{fig:sphere_hydrogen_density_study_perf}
\end{figure}

To understand this utilization more deeply with respect to material parameters,
the hydrogen density was varied from 0 to 1 $\frac{g}{cm^3}$ in the single-volume
sphere test problem with a 5 MeV neutron point source. For each density, one
simulation was performed without the signed distance field and another with the
signed distance field and preconditioning enabled. Fig.
\ref{fig:sphere_hydrogen_density_study_util} shows the results of this study. 

\begin{figure}[ht]
  \centering
  \includesvg{../images/sdf_hydrogen_density_study_util}{0.5\textwidth}
  \caption{Utilization results for a 5 MeV neutron source at the origin of a 10 cm radius
    sphere. Hydrogen density was varied from 0 to 1 $\frac{g}{cm^3}$.}
  \label{fig:sphere_hydrogen_density_study_util}
\end{figure}

Utilization of the data structure in this study remains high until the hydrogen
density falls to 0.1 $\frac{g}{cm^3}$ at which point a distinct knee appears and
the utilization falls off quickly. Even at the lowest density reached in the
study of 0.01 $\frac{g}{cm^3}$, the utilization of the signed distance field to
avoid ray fire calls is 0.54.  It is difficult to judge the impact on the
performance of this simulation for these low density values due to the limited
size of the geometry and the short lived histories. As the material density
decreases, particles quickly leave the geometry after very few collisions, but
Fig. \ref{fig:sphere_hydrogen_density_study_perf} provides an impression of the
performance of these three implementations converge as the density of the
hydrogen is varied. The application of the signed distance field allows for
significantly improved performance until the density drops below 0.1
$\frac{g}{cm^3}$ in agreement with utilization plot. In order to have more
control over a simulation's physical parameters, subsequent experiments were
performed using a simple simulation tool.

